@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<style>
    .appBar {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        height: 3.5rem;
        display: flex;
    }
</style>

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout Class="h-100">
    <MudAppBar Style="@($"color:{Colors.LightGreen.Accent3}; background:{Colors.BlueGrey.Darken4}; z-index:100; padding: 0; ")" Class="appBar">
        <AuthorizeView>
            <MudTooltip Text="Menu" Arrow="true">
                <MudIconButton Icon="@Icons.Material.Filled.Menu" Style="@($"color:{Colors.LightGreen.Accent3}")" OnClick="@ToggleDrawer"></MudIconButton>
            </MudTooltip>
        </AuthorizeView>
        <MudNavLink Href="/" Match="NavLinkMatch.All">
            <MudText Typo="Typo.h5" Align="Align.Center" Class="w-100" Style="@($"color:{Colors.LightGreen.Accent3};" )"></MudText>
        </MudNavLink>
        <AuthorizeView Roles="USER">
            <MudTooltip Text="My Cart" Arrow="true">
                <MudIconButton Icon="@Icons.Material.Filled.ShoppingCart" Color="Color.Error" OnClick="@(()=> NavigationManager.NavigateTo("/my-cart"))"></MudIconButton>
            </MudTooltip>
        </AuthorizeView>
        <MudSpacer />
    </MudAppBar>
    <AuthorizeView>
        <MudDrawer Id="drawer" Open="@_drawerOpen">
            <NavMenu />
        </MudDrawer>
    </AuthorizeView>

    <MudMainContent Class="h-100">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="h-100  w-100 p-3">
            @ChildContent
        </MudContainer>
    </MudMainContent>
</MudLayout>


@code {
    private AuthenticationState? authenticationState;

    protected override async Task OnInitializedAsync()
    {
        authenticationState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        if (authenticationState.User?.Identity?.IsAuthenticated == false)
        {
            NavigationManager.NavigateTo("/login");
        }
    }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    bool _drawerOpen = true;

    void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }
}
